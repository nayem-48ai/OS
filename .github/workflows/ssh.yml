name: Terminus SSH Solution
on: 
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  ssh-access:
    runs-on: ubuntu-latest
    steps:
      - name: Setup SSH User
        run: |
          sudo useradd -m -s /bin/bash tnayem48
          echo "tnayem48:tnayem48" | sudo chpasswd
          sudo usermod -aG sudo tnayem48
          sudo service ssh start

      - name: Start Tmate and Show Clean Details
        run: |
          sudo apt-get update && sudo apt-get install -y tmate
          tmate -S /tmp/tmate.sock new-session -d
          tmate -S /tmp/tmate.sock wait tmate
          
          # সরাসরি SSH URL টি বের করা
          SSH_URL=$(tmate -S /tmp/tmate.sock display -p '#{tmate_ssh}')
          
          # হোস্ট এবং পোর্ট আলাদা করা
          # এটি ফরম্যাট করবে: ssh username@host -p port
          USER_HOST=$(echo $SSH_URL | cut -d'@' -f2)
          HOST=$(echo $USER_HOST | cut -d':' -f1)
          PORT=$(echo $USER_HOST | cut -d':' -f2)
          
          echo "=========================================="
          echo "   COPY THESE TO TERMINUS APP   "
          echo "=========================================="
          echo "Host: $HOST"
          echo "Port: $PORT"
          echo "Username: tnayem48"
          echo "Password: tnayem48"
          echo "=========================================="
          
          # সেশনটি ৬ ঘণ্টা সচল রাখবে
          sleep 21600
