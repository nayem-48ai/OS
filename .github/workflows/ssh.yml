name: Terminus SSH Solution
on: 
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  ssh-access:
    runs-on: ubuntu-latest
    steps:
      - name: Single Step SSH Setup
        run: |
          # ১. ইউজার এবং SSH সেটআপ
          sudo useradd -m -s /bin/bash tnayem48
          echo "tnayem48:tnayem48" | sudo chpasswd
          sudo usermod -aG sudo tnayem48
          sudo service ssh start
          
          # ২. Tmate ইন্সটল ও রান
          sudo apt-get update -y > /dev/null
          sudo apt-get install -y tmate > /dev/null
          tmate -S /tmp/tmate.sock new-session -d
          tmate -S /tmp/tmate.sock wait tmate
          
          # ৩. ডিটেইলস প্রিন্ট করা
          SSH_URL=$(tmate -S /tmp/tmate.sock display -p '#{tmate_ssh}')
          USER_HOST=$(echo $SSH_URL | cut -d'@' -f2)
          HOST=$(echo $USER_HOST | cut -d':' -f1)
          PORT=$(echo $USER_HOST | cut -d':' -f2)
          
          echo "=========================================="
          echo "   COPY THESE TO TERMINUS APP   "
          echo "=========================================="
          echo "Host: $HOST"
          echo "Port: $PORT"
          echo "Username: tnayem48"
          echo "Password: tnayem48"
          echo "=========================================="
          
          # সেশনটি সচল রাখা
          sleep 21600
