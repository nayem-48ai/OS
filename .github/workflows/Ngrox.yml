- name: Setup SSH Server and User
        run: |
          USER="${{ inputs.ssh_user }}"
          PASS="${{ inputs.ssh_password }}"
          sudo apt-get update
          sudo apt-get install -y openssh-server
          sudo useradd -m -s /bin/bash "$USER"
          echo "$USER:$PASS" | sudo chpasswd
          sudo usermod -aG sudo "$USER"
          sudo sed -i 's/^#*PasswordAuthentication .*/PasswordAuthentication yes/' /etc/ssh/sshd_config
          sudo service ssh restart
          echo "✅ SSH server is ready."

      - name: Expose SSH using ngrok
        run: |
          # ngrok ডাউনলোড এবং ইনস্টল
          curl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc >/dev/null
          echo "deb https://ngrok-agent.s3.amazonaws.com buster main" | sudo tee /etc/apt/sources.list.d/ngrok.list
          sudo apt update
          sudo apt install ngrok

          # আপনার ngrok authtoken সেট করুন (এটি GitHub Secrets থেকে নেওয়া উচিত)
          ngrok config add-authtoken ${{ secrets.NGROK_AUTHTOKEN }}

          # ব্যাকগ্রাউন্ডে ngrok টানেল চালু করুন
          nohup ngrok tcp 22 &

          # পাবলিক অ্যাড্রেস পাওয়ার জন্য কয়েক সেকেন্ড অপেক্ষা করুন
          sleep 10
          
          # ngrok API থেকে পাবলিক URL বের করুন এবং প্রিন্ট করুন
          PUBLIC_URL=$(curl -s http://127.0.0.1:4040/api/tunnels | jq -r '.tunnels[0].public_url')
          
          echo "✅ ngrok tunnel is up!"
          echo "Connect with:"
          echo "ssh ${{ inputs.ssh_user }}@${PUBLIC_URL/tcp:\/\//}" # "tcp://" অংশটুকু সরিয়ে ফেলা হলো
          echo "Password: ${{ inputs.ssh_password }}"
          echo "Full command: sshpass -p '${{ inputs.ssh_password }}' ssh -p ${PUBLIC_URL##*:} ${{ inputs.ssh_user }}@${PUBLIC_URL//:*
/}"

      - name: Keep alive
        # এই ধাপটি আগের মতোই থাকবে
        run: |
          # ... আগের মতোই ...
